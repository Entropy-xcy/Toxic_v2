\documentclass[11pt]{book}
\usepackage{graphicx}
\usepackage{hyperref}
\begin{document}
\begin{titlepage}
    \thispagestyle{empty}
    \title{%
    Toxic Processor \\
    \large A simplistic 4-bit processor ready to synthesis \\ 
    Version 2.0.0}
    \author{Entropy Xu \\ 
            \href{mailto:entropy.xcy@protonmail.com}{entropy.xcy@protonmail.com} }
    \maketitle
    \end{titlepage}
    \tableofcontents


    \chapter{Introduction}
    \section{Intention}
    \section{Advantages}
    \section{Limitations}
    \section{History of Revisions}


    \chapter{Design of the Processor}
    \section{Overview}
    This processor is a \textbf{4-bit} \textbf{Stack machine} (0-address machine).
    \begin{itemize}
        \item The addressing width is configurable to be a multiple of 4.
        \item The stack depth is configurable to be greater than 16.
        \item The width of each Instruction is 4 bits. Thus, 16 Instructions in total.
        \item The width of each block inside the stack is 4 bits.
        \item Von Neumann Architecture: seperate data memory and code memory.
        \item Code memory and data memory are using the same addressing space.
    \end{itemize}

    \section{Data Structure}
    The name \textbf{stack machine} or equivalently 0-address machine means that 
    there is no addressable register in this machine neither do operands in the instructions. \par
    
    In order to store temporary data in this processor, we use a hardware stack to replace 
    the register file which is usually implemented by other popular processors. \par

    The 4-bit block-data-width will not limit the scalability of this processor in that addressing
    width of this processor is 4-bits but a configurable width of a multiple of 4 
    (usually 8 bits or 12 bits or 16 bits).

    \subsection{Stack for Storing Temporary Data}
    We have a stack for storing temporary data. 
    Stack is a LIFO (Last In First Out) data structure.
    Each block of the stack is a 4-bits register.
    The stack supports common operations like push and pop. For each Instruction we execute,
    we will have to read value from TOS (Top of Stack) and NTOS (Next Top of Stack), 
    and push the result of the operations to the stack.
    (Refer to Figure \ref{figure:stack_model} for the model of the stack)
    \begin{figure}[h!]
        \centering
        \includegraphics[scale=0.6]{Toxic_Stack_Model.png}
        \caption{Toxic Stack Model}
        \label{figure:stack_model}
    \end{figure}

    \subsection{Queue for Addressing Bus}
    We have discussed that the addressing width for the Toxic processor is configurable and 
    usually more than 4 bits. Thus, we establish a Queue as the data structure for storing
    the address of the Bus. For the length of the queue, we have $Length(Queue) = BitWidth(BusAddress) / 4 * 2$ \par
    Queue is a FIFO data structure. However, the Queue data structure we used in the Toxic 
    processor is similar to the common Queue but with some tweaks. Same as the stack, each 
    block in the Queue is a 4-bits register. The Queue should supports common operations like 
    \textbf{enqueue} and \textbf{dequeue}. Refer to Figure \ref{figure:queue_model} for the model
    of the queue and the connection with the BusAddress. Noted that, when we \textbf{enqueue}, all
    the blocks shift left one position relative to the BusAddress; when we \textbf{dequeue}, all
    the blocks shift right one position relative to the BusAddress.
    \begin{figure}[h!]
        \centering
        \includegraphics[scale=0.5]{Toxic_Queue_Model.png}
        \caption{Toxic Queue Model}
        \label{figure:queue_model}
    \end{figure}
    \subsection{Memory}
    The memory of the Toxic processor is accessed through Bus and only takes part of the addressing space. 
    The model of the Memory is different from common RAMs since for common RAMs, the block bit width is 1 bype (8 bits)
    while for the Toxic processor, the width of a block is half-byte (4 bits). \par
    For the Toxic processor, we assign the width of each block of the memory to be 4 bits.
    This memory model can be easily implemented using a standard memory block and would be discussed in detail in 
    Chapter \ref{chapter:implementation}.
    Detailed addressing space definitions can be found in detail in section \ref{section:addressingspace}.

    \section{Addressing Modes}
    There are three addressing modes in the Toxic processor:
    \begin{itemize}
        \item TOS (Top of Stack)
        \item NTOS (Next Top of Stack)
        \item Bus for memory and peripherals
    \end{itemize}

    \section{Addressing Space}
    These definitions for the addressing space is for the standard version of the Toxic processor.
    More versions of definitions of implementations can be found in Chapter \ref{chapter:implementation}
    \label{section:addressingspace}
    \subsection{Reserved: 0x0-0xf}
    \subsection{Code Memory: 0x10-0xffff}
    \subsection{Data Memory: 0x1000}
    \subsection{Peripherals:}




    \chapter{Instruction Set Architecture}
    \section{Instructions Map}
    \begin{table}[h]
        \begin{tabular}{|l|l|l|l|l|}
        \hline
        1:0\textbackslash{}3:2 & 00  & 01  & 11   & 10 \\ \hline
        00                     & P0  & POP & ADD  & SV \\ \hline
        01                     & P1  & DIS & NAND & LD \\ \hline
        11                     & CMP & SWP & LS   & B1 \\ \hline
        10                     & CD  & RVS & RS   & B0 \\ \hline
        \end{tabular}
    \end{table}
    \section{Push Instructions}
    \subsection{P0}
    \subsection{P1}

    \section{Stack and Bus Operation Instructions}
    \subsection{POP}
    \subsection{DIS}
    \subsection{SWP}
    \subsection{RVS}

    \section{Numeric Computing Instructions}
    \subsection{ADD}
    \subsection{NAND}
    \subsection{LS}
    \subsection{RS}

    \section{Memory Operations Instructions}
    \subsection{SV}
    \subsection{LD}
    \subsection{CD}

    \section{Branch Instructions}
    \subsection{B1}
    \subsection{B0}

    \section{Special Instructions}
    \subsection{CMP}



    \chapter{Implementation}
    \label{chapter:implementation}
    \section{Modules List}
    \section{Data Path}


\end{document}
